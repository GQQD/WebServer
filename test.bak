/**************************************
*文件说明:test.c
*作者:高小调
*创建时间:2017年07月31日 星期一 19时16分48秒
*开发环境:Kali Linux/g++ v6.3.0
****************************************/
#include"httpd.h"
int main(int argc,const char * argv[]){
	if(argc!=2){
		printf("Usage:%s [port]\n",argv[0]);
		return 1;
	}
	int listen_sock = get_listen_sock(atoi(argv[1]));
	while(1){	
	//处理新客户连接
		struct sockaddr_in client;
		socklen_t len = sizeof(client);
		int new_client = accept(listen_sock,(struct sockaddr*)&client,&len);
		if(new_client < 0){
			perror("accept");
			break;		
		}
		printf("get a new client:%s:%d\n",inet_ntoa(client.sin_addr),ntohs(client.sin_port));
		handle_http_request(new_client);
		//close(new_client);
	}//while
	close(listen_sock);
	return 0;
}
